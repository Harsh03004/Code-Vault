<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Vault</title>
    <link rel="stylesheet" href="style.css" />
    <!-- CodeMirror CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css"
    />
  </head>
  <body>
    <!-- Top Navbar -->
    <nav class="navbar">
      <div class="logo">Code Vault</div>
      <div class="nav-links">
        <button onclick="window.location.href='dashboard.html'">Dashboard</button>
        <button class="active">Vault</button>
        <button onclick="window.location.href='profile.html'">Profile</button>
      </div>
    </nav>

    <!-- Main Layout -->
    <div class="main-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div id="current-snippet-name" style="padding: 10px; color: #00f6ff; font-weight: bold; text-align: center; border-bottom: 1px solid #2a2d35;">
          New Snippet
        </div>
        <input
          type="text"
          placeholder="Search snippets..."
          class="search-bar"
          id="sidebar-search"
          onkeyup="filterSidebarSnippets()"
        />
        <ul class="snippet-list" id="sidebar-snippet-list">
          <li style="color: #888; text-align: center; padding: 20px;">Loading...</li>
        </ul>
        <div class="sidebar-buttons">
          <button class="add-btn" onclick="createNewSnippet()">Add New Snippet</button>
          <button class="encrypt-btn" id="encryptBtn">Encrypt/Decrypt</button>
        </div>
      </aside>

      <!-- Editor + AI Assistant -->
      <div class="workspace">
        <!-- Toolbar -->
        <div class="toolbar">
          <button onclick="saveSnippet()" style="background: linear-gradient(90deg, #00f6ff, #4fd1c5); color: #0f1117; font-weight: bold;">üíæ Save Code</button>
          <button>Run AI Analysis</button>
          <button>Explain Code</button>
          <button>Generate Docs</button>
          <button>Optimize</button>
        </div>

        <div class="editor-assistant">
          <!-- Code Editor -->
          <div class="editor" id="editor"></div>

          <!-- AI Assistant -->
          <aside class="assistant">
            <h3>AI Assistant</h3>
            <div class="chat-window" id="chat-window">
              <div class="user-msg">Explain the quantum_sort algorithm.</div>
              <div class="ai-msg">
                The quantum sort algorithm utilizes quantum principles...
              </div>
            </div>
            <div class="chat-input">
              <input
                type="text"
                id="assistant-input"
                placeholder="Message AI Assistant..."
              />
              <button id="send-btn">Send</button>
            </div>
          </aside>
        </div>
      </div>
    </div>

    <!-- Save Snippet Modal -->
    <div id="saveModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
      <div style="background: #14161c; padding: 30px; border-radius: 12px; box-shadow: 0 0 30px rgba(0, 246, 255, 0.5); max-width: 450px; width: 90%;">
        <h2 style="color: #00f6ff; margin-bottom: 20px;">Save Code Snippet</h2>
        
        <input type="text" id="snippetNameInput" placeholder="Enter snippet name..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #2a2d35; background: #1f222a; color: #e0e0e0; font-size: 1rem; margin-bottom: 15px;" />
        
        <div style="margin-bottom: 15px;">
          <label style="display: flex; align-items: center; color: #e0e0e0; cursor: pointer;">
            <input type="checkbox" id="encryptCheckbox" onchange="toggleEncryptionFields()" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;" />
            <span style="font-size: 1rem;">üîí Encrypt this snippet</span>
          </label>
        </div>

        <div id="encryptionFields" style="display: none; margin-bottom: 15px;">
          <input type="password" id="encryptionPassword" placeholder="Enter encryption password..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #2a2d35; background: #1f222a; color: #e0e0e0; font-size: 1rem; margin-bottom: 10px;" />
          <input type="password" id="confirmEncryptionPassword" placeholder="Confirm password..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #2a2d35; background: #1f222a; color: #e0e0e0; font-size: 1rem;" />
          <p style="color: #888; font-size: 0.85rem; margin-top: 8px;">‚ö†Ô∏è Remember this password! You'll need it to decrypt your code.</p>
        </div>

        <div style="display: flex; gap: 10px;">
          <button onclick="closeSaveModal()" style="flex: 1; padding: 10px; border: none; border-radius: 6px; background: #2a2d35; color: #e0e0e0; cursor: pointer; font-weight: bold;">Cancel</button>
          <button onclick="confirmSave()" style="flex: 1; padding: 10px; border: none; border-radius: 6px; background: linear-gradient(90deg, #00f6ff, #4fd1c5); color: #0f1117; cursor: pointer; font-weight: bold;">Save</button>
        </div>
        <div id="saveError" style="color: #ff4d4d; margin-top: 15px; font-size: 0.9rem; display: none;"></div>
      </div>
    </div>

    <!-- Decrypt Modal -->
    <div id="decryptModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
      <div style="background: #14161c; padding: 30px; border-radius: 12px; box-shadow: 0 0 30px rgba(0, 246, 255, 0.5); max-width: 400px; width: 90%;">
        <h2 style="color: #00f6ff; margin-bottom: 20px;">üîì Decrypt Snippet</h2>
        <p style="color: #e0e0e0; margin-bottom: 15px;">This snippet is encrypted. Enter the password to decrypt:</p>
        <input type="password" id="decryptPassword" placeholder="Enter decryption password..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #2a2d35; background: #1f222a; color: #e0e0e0; font-size: 1rem; margin-bottom: 20px;" />
        <div style="display: flex; gap: 10px;">
          <button onclick="closeDecryptModal()" style="flex: 1; padding: 10px; border: none; border-radius: 6px; background: #2a2d35; color: #e0e0e0; cursor: pointer; font-weight: bold;">Cancel</button>
          <button onclick="confirmDecrypt()" style="flex: 1; padding: 10px; border: none; border-radius: 6px; background: linear-gradient(90deg, #00f6ff, #4fd1c5); color: #0f1117; cursor: pointer; font-weight: bold;">Decrypt</button>
        </div>
        <div id="decryptError" style="color: #ff4d4d; margin-top: 15px; font-size: 0.9rem; display: none;"></div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      // Check if user is authenticated
      const accessToken = localStorage.getItem('accessToken');
      if (!accessToken) {
        // Redirect to login if no token found
        window.location.href = 'login.html';
      }

      // Snippet management variables
      const BASE_URL = 'http://localhost:3000/api';
      let currentSnippetId = null;
      let allSnippets = [];
      let hasUnsavedChanges = false;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="vault.js"></script>
    <script src="app.js"></script>
    
    <!-- Snippet Management Script -->
    <script src="snippets.js"></script>
  </body>
</html>
